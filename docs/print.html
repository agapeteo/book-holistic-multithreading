<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Holistic multithreading</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="this_book.html"><strong aria-hidden="true">1.1.</strong> How this book is different</a></li><li class="chapter-item expanded "><a href="why.html"><strong aria-hidden="true">1.2.</strong> Why multithreading is important</a></li><li class="chapter-item expanded "><a href="history.html"><strong aria-hidden="true">1.3.</strong> A brief history of thread</a></li></ol></li><li class="chapter-item expanded "><a href="languages.html"><strong aria-hidden="true">2.</strong> Concurrency and multithreading in practical languages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="java.html"><strong aria-hidden="true">2.1.</strong> Java</a></li><li class="chapter-item expanded "><a href="c.html"><strong aria-hidden="true">2.2.</strong> C</a></li><li class="chapter-item expanded "><a href="c++.html"><strong aria-hidden="true">2.3.</strong> C++</a></li><li class="chapter-item expanded "><a href="rust.html"><strong aria-hidden="true">2.4.</strong> Rust</a></li><li class="chapter-item expanded "><a href="golang.html"><strong aria-hidden="true">2.5.</strong> Go</a></li><li class="chapter-item expanded "><a href="python.html"><strong aria-hidden="true">2.6.</strong> Python</a></li><li class="chapter-item expanded "><a href="javascript.html"><strong aria-hidden="true">2.7.</strong> JavaScript</a></li></ol></li><li class="chapter-item expanded "><a href="threads_under_the_hood.html"><strong aria-hidden="true">3.</strong> Threads under the hood</a></li><li class="chapter-item expanded "><a href="critical_section.html"><strong aria-hidden="true">4.</strong> Critical section</a></li><li class="chapter-item expanded "><a href="atomics.html"><strong aria-hidden="true">5.</strong> Atimics and memory fences</a></li><li class="chapter-item expanded "><a href="communication.html"><strong aria-hidden="true">6.</strong> Thread communication</a></li><li class="chapter-item expanded "><a href="deadlocks.html"><strong aria-hidden="true">7.</strong> Deadlocks and live locks</a></li><li class="chapter-item expanded "><a href="coroutines.html"><strong aria-hidden="true">8.</strong> Coroutines and async programming</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">9.</strong> Debugging and testing</a></li><li class="chapter-item expanded "><a href="best_practices.html"><strong aria-hidden="true">10.</strong> Best practices</a></li><li class="chapter-item expanded "><a href="threads_brainstorm.html"><strong aria-hidden="true">11.</strong> Brainstorm</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Holistic multithreading</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>The history of computing is a constant struggle for efficiency. From the first machine to the first operating systems to the multicore processors and
modern operating systems. Concurrency emerged to make resource use more efficient. It has also shaped modern operating systems and hardware along the
way.</p>
<p>As the hardware evolves, we can hope to solve more computationally intense problems faster. And we definitely see the impact this hope has on the
industry with the proliferation of javascript and python solutions almost everywhere: from desktop with frameworks like electron, to server side with
node.js, to even MCUs and the IoT with micropython. These solutions are far from being efficient in their resource use.</p>
<p>But there is a twist thanks to a thing called Moore's Law, or more precisely, to its end. Of course, we can argue about the end of Moore's Law, but
the facts are clear: it is getting harder to simply add transistors to a chip. It is also clear that the evolution of processors has shifted towards
multicore systems. So to make software more efficient and to take full advantage of the multicore CPUs, we have to employ concurrent algorithms. And
to do it effectively, we need to understand how concurrency works.</p>
<p>For this we have to understand relevant abstractions of computer science. But that is not it unfortunately, as we're dealing with a case of a leaky
abstraction. What we have to understand just as well is the language support for concurrency (or lack thereof, as is the case with javascript and
python), i.e. how these abstractions are implemented by our language of choice. But even that is not all. Another important aspect is what is going
on in the virtual machine, if any, and in the operating system. What is done at the level of assembly, and last but not least, what is happening in
the CPU itself.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-this-book-is-different"><a class="header" href="#how-this-book-is-different">How this book is different</a></h1>
<blockquote>
<p>TODO</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="purpose"><a class="header" href="#purpose">Purpose</a></h1>
<p>Multithreading from top to bottom. From abstractions like concurrent hash maps to assembler instructions.
General narrative when introducing a new concept: how and why this concept came to be.
Only after that can we dive into details. We intend to provide references for people to dive deeper on particular topics.</p>
<h2 id="audience"><a class="header" href="#audience">Audience</a></h2>
<p>Who this book is for? We assume that you have a basic understanding of what an operating system is and a very basic understanding of computer hardware.
We also assume that you have a basic knowledge of Java, C, C++, or Rust.</p>
<h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>A simple example with one or two threads. What happens:</p>
<ul>
<li>On the language level;</li>
<li>On the OS level;</li>
<li>On the hardware level.</li>
<li>Sometimes you're using thread even when you are not aware of it. (Servlets example)</li>
</ul>
<p>The rest of the books is just a deeper and broader exploration of what we have just covered.</p>
<h1 id="theory"><a class="header" href="#theory">Theory</a></h1>
<p>Theoretical basis for concurrency. Threading models, scheduling, safety and liveness properties, mutexes, deadlocks, starvation.</p>
<h1 id="operating-system"><a class="header" href="#operating-system">Operating system</a></h1>
<p>What is a Thread? Threads exists in an operating system. There's no reason to talk about threads outside of the OS.
If ypu want threads on the bare metal you will end up implementing your own minimalistic OS.</p>
<h1 id="hardware"><a class="header" href="#hardware">Hardware</a></h1>
<p>Basics of hardware architecture. How does hardware support multithreading? How did CPU evolved alongside OS and what impact they had on each other.</p>
<h1 id="low-level-abstractions"><a class="header" href="#low-level-abstractions">Low Level Abstractions</a></h1>
<p>Thread and other concurrency primitives.</p>
<h1 id="high-level-abstractions"><a class="header" href="#high-level-abstractions">High Level Abstractions</a></h1>
<p>Concurrent Hash Map and other stuff.</p>
<h1 id="concurrent-algorithms"><a class="header" href="#concurrent-algorithms">Concurrent Algorithms</a></h1>
<h1 id="testing-concurrency"><a class="header" href="#testing-concurrency">Testing concurrency</a></h1>
<h1 id="programming-models"><a class="header" href="#programming-models">Programming models</a></h1>
<p>Shared memory, message passing...</p>
<h1 id="cooperative-scheduling"><a class="header" href="#cooperative-scheduling">Cooperative scheduling</a></h1>
<p>Coroutines and their cousins. Java virtual threads. How are these things implemented. What are the benefits.</p>
<h1 id="posix-threads"><a class="header" href="#posix-threads">Posix Threads</a></h1>
<h1 id="languages"><a class="header" href="#languages">Languages</a></h1>
<p>Java, C, C++, Rust, JS/Python (only to critisize their lack of comprehensive threading support).</p>
<h1 id="test-hardware"><a class="header" href="#test-hardware">Test Hardware</a></h1>
<p>MBP Pro, Raspberry Pi, Pine64 SBC.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="a-brief-history-of-thread"><a class="header" href="#a-brief-history-of-thread">A brief history of thread</a></h1>
<ul>
<li>History of thread</li>
<li>What is thread </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>#TODO</p>
<div style="break-before: page; page-break-before: always;"></div><p>#TODO</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="c"><a class="header" href="#c">C</a></h1>
<blockquote>
<p>TODO</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="c-1"><a class="header" href="#c-1">C++</a></h1>
<blockquote>
<p>TODO</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="go-language"><a class="header" href="#go-language">Go language</a></h1>
<blockquote>
<p>TOOD</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="threads-under-the-hood"><a class="header" href="#threads-under-the-hood">Threads under the hood</a></h1>
<ul>
<li>sort file without joining. note on main thread</li>
<li>sort file with joining and mutex and going deep:
<ul>
<li>language level</li>
<li>compiler level</li>
<li>assembly level</li>
<li>operating system level</li>
<li>cpu level</li>
<li>same example in Assembly</li>
<li>summary</li>
</ul>
</li>
</ul>
<blockquote>
<p>TODO: add note about thread cancellation</p>
</blockquote>
<p>from The Linux programming interface:</p>
<blockquote>
<p>The execution of a thread terminates in one of the following ways:</p>
</blockquote>
<p>• The thread’s start function performs a return specifying a return value for the thread.</p>
<p>• The thread calls pthread_exit() (described below).</p>
<p>• The thread is canceled using pthread_cancel() (described in Section 32.1).</p>
<p>• Any of the threads calls exit(), or the main thread performs a return (in the main() function), which causes all threads in the process to terminate immediately.</p>
<p>include &lt;pthread.h&gt;</p>
<p>void pthread_exit(void *retval);</p>
<p>Calling pthread_exit() is equivalent to performing a return in the thread’s start function, with the difference that pthread_exit() can be called from any function that has been called by the thread’s start function.</p>
<p>The retval argument specifies the return value for the thread. The value pointed to by retval should not be located on the thread’s stack, since the contents of that stack become undefined on thread termination. (For example, that region of the process’s virtual memory might be immediately reused by the stack for a new thread.) The same statement applies to the value given to a return statement in the thread’s start function.</p>
<p>The pthread_exit() function terminates the calling thread, and specifies a return value that can be obtained in another thread by calling pthread_join().</p>
<blockquote>
<p>If the main thread calls pthread_exit() instead of calling exit()
or performing a return, then the other threads continue to execute.</p>
</blockquote>
<blockquote>
<p>TODO: add notice about hazard pointers and similar?</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="critical-section"><a class="header" href="#critical-section">Critical section</a></h1>
<ul>
<li>
<p>we're protecting data, not code</p>
</li>
<li>
<p>Mutex types</p>
</li>
<li>
<p>spin lock under hood... (all levels)</p>
<ul>
<li>atomic operation overview</li>
</ul>
</li>
<li>
<p>lock with help of cpu... (all levels)</p>
<ul>
<li>futex</li>
</ul>
</li>
<li>
<p>lock types, semaphores</p>
</li>
<li>
<p>let's check performance</p>
</li>
<li>
<p>note on adaptive locking (Java, Rust)</p>
</li>
</ul>
<blockquote>
<p>TODO mention transactinal memory annd lack of it 
https://en.wikipedia.org/wiki/Transactional_Synchronization_Extensions</p>
</blockquote>
<blockquote>
<p>futex in Different OSs https://shift.click/blog/futex-like-apis/</p>
</blockquote>
<blockquote>
<p>TODO <a href="https://webkit.org/blog/6161/locking-in-webkit/">WebKit locks implementation using parking lot approach</a></p>
</blockquote>
<blockquote>
<p>TODO <a href="https://www.kernel.org/doc/ols/2002/ols2002-pages-479-495.pdf">Fuss, Futexes and Furwocks: Fast Userlevel Locking in Linux</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="atomics-and-memory-fences"><a class="header" href="#atomics-and-memory-fences">Atomics and memory fences</a></h1>
<ul>
<li>why Peterson's solution doesn't work with my PC</li>
<li>cpu cache coherance</li>
<li>ordering</li>
<li>perf check overview</li>
</ul>
<blockquote>
<p>TODO: add atomic problems like false sharing and cache ping-pong</p>
</blockquote>
<h3 id="volatile"><a class="header" href="#volatile">volatile</a></h3>
<p><code>volatile</code> keyword has a different meaning for Java and C/C++.
C and C++ usually don't use <code>volatile</code> for memory ordering guarantees, except some rare cases like mamory-mapped IO.
volatile may help prevennting reordering with other volatile variable, but not with non-volatile variable.
So it is recommended to use locks and atomics instead. 
<a href="https://www.kernel.org/doc/html/latest/process/volatile-considered-harmful.html">See why valatile considered harmful in Linux kernel</a></p>
<p>Java uses <code>volatile</code> for some memory ordrering guarantees, see <a href="https://download.oracle.com/otndocs/jcp/memory_model-1.0-pfd-spec-oth-JSpec/">JSR-133</a></p>
<p>Rust and Go don't have <code>volatile</code> variables at all. These langauages propose using reads and writes functions.</p>
<h3 id="etc"><a class="header" href="#etc">etc</a></h3>
<blockquote>
<p>TODO: blog post on write bufferes https://paulcavallaro.com/blog/x86-tso-a-programmers-model-for-x86-multiprocessors/
<a href="https://www.cl.cam.ac.uk/~pes20/weakmemory/cacm.pdf">whitepaper which blog is referenncing to on write buffers</a></p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/MESI_protocol">https://en.wikipedia.org/wiki/MESI_protocol</a></p>
<p><a href="http://hps.ece.utexas.edu/people/suleman/class_projects/pca_report.pdf">An Evaluation of Snoop-Based Cache Coherence Protocols, whitepaper</a></p>
<p><a href="https://yarchive.net/comp/linux/store_buffer.html">! Linus Torvarld on write buffers issue note</a></p>
<h3 id="mesi-visual-interactive"><a class="header" href="#mesi-visual-interactive">MESI visual interactive</a></h3>
<p><a href="https://www.scss.tcd.ie/Jeremy.Jones/vivio/caches/MESIHelp.htm">https://www.scss.tcd.ie/Jeremy.Jones/vivio/caches/MESIHelp.htm</a></p>
<h3 id="not-sure-if-i-should-include-next-refereces-todo-check-and-decide"><a class="header" href="#not-sure-if-i-should-include-next-refereces-todo-check-and-decide">not sure if I should include next refereces. TODO: check and decide</a></h3>
<p><a href="http://hps.ece.utexas.edu/people/suleman/class_projects/pca_report.pdf">An Evaluation of Snoop-Based Cache Coherence Protocols, whitepaper</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="thread-communications"><a class="header" href="#thread-communications">Thread communications</a></h1>
<ul>
<li>condvar going deep</li>
<li>wait groups</li>
<li>channels</li>
<li>actors</li>
<li>accumulator example</li>
<li>queues and other data structures</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deadlocks-and-live-locks"><a class="header" href="#deadlocks-and-live-locks">Deadlocks and live locks</a></h1>
<blockquote>
<p>TOOD</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="coroutines-and-async-programming"><a class="header" href="#coroutines-and-async-programming">Coroutines and async programming</a></h1>
<blockquote>
<p>TODO</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-and-testing"><a class="header" href="#debugging-and-testing">Debugging and testing</a></h1>
<blockquote>
<p>TOOD</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="best-practices"><a class="header" href="#best-practices">Best practices</a></h1>
<blockquote>
<p>TODO</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="threads-under-the-hood-brainstorming"><a class="header" href="#threads-under-the-hood-brainstorming">Threads under the hood brainstorming</a></h1>
<h2 id="why-multithreading"><a class="header" href="#why-multithreading">Why multithreading</a></h2>
<ul>
<li>why are you reading this book?</li>
</ul>
<p>History of computing through the lens of efficiency. From early operation systems to present day. You can use threads to use CPU efficiently.
We can either create efficient software or keep wasting money on suboptimal algorithms. The choice is yours. You can safe the world from the farting cows and AOC.
When we talk about history we talk about hardware, OS, and programming languages, how they evolved together and influenced one another.</p>
<p>TODO: insert a graph of energy use by language.</p>
<h2 id="applications-processes-and-threads"><a class="header" href="#applications-processes-and-threads">Applications, processes and threads</a></h2>
<ul>
<li>what is application, </li>
<li>group of tasks that help to archive some goal</li>
<li>application can run one or more processes on a single or multiple computers. </li>
</ul>
<p>TODO languages and code
Application -&gt; tasks -&gt; algorithms &amp; data structures -&gt; code -&gt; languages</p>
<p>Applications consist of structure or sequence of tasks. Tasks are solved by applying algorithms to data structures.
Algorithms and data structures are represented with programming languages, which translate human concepts into binary machine code of specific hardware.
As you have probably noticed, we've described a chain of abstractions. Let's make a brief detour and discuss what is an abstraction.
Abstraction is notion that separates something generic (general) from specific. Why would we need that?
It helps us recognize and apply patterns to a group of notions while ignoring unrelated details. When some details become relevant, an abstraction becomes leaky.
We have noticed that threads are often described with leaky abstractions. They can work at some level of analysis, but inevitably break down...</p>
<h2 id="why-use-threads"><a class="header" href="#why-use-threads">Why use threads?</a></h2>
<ul>
<li>
<p>speed and efficiency</p>
</li>
<li>
<p>Moore's law</p>
</li>
<li>
<p>why clock rate is not growing that fast</p>
</li>
<li>
<p>cost</p>
</li>
<li>
<p>heat and power consumption</p>
</li>
<li>
<p>Amdahl's law</p>
</li>
</ul>
<h2 id="thread-history"><a class="header" href="#thread-history">Thread history</a></h2>
<p>3 original authors. 
from multiprogramming operating systems to multithreaded applications</p>
<p>Operating systems are about effectively running applications on the given hardware.
Effectively could also mean
?? what is OS
That's why operating system may represent application as a runing process. 
OS limits what process can do, but in returns it gives greater flexibility and effency overall.</p>
<p>Process is the means by which Operating Systems runs application.
Stricktly speaking, Operation System is not mandatory to run multiple processes. For example in amberdded hardware.
But you still need to schedule processes somehow, so you need at least a scheduler to manage multiple processes.</p>
<p>Creating a process is complex task that includes:</p>
<ul>
<li>finding and allocting memory</li>
<li>etc.. TODO</li>
<li>TODO</li>
</ul>
<p>it's not even an exhastive list</p>
<p>But there is another OS abtraction that can significantly simplify the way we can execute code on a given cpu - 
THREADS
T
THREADS ARE</p>
<p>-- responsibility OS</p>
<p>safety
resources 
memory</p>
<p>memory types
code - data</p>
<p>stack
memory segments</p>
<p>Each thread own stack, registers, but everyhting else is shared</p>
<p>compiled application format for OS - ELF, ...</p>
<p>preemtive, cooperative</p>
<p>OS CPU allocation </p>
<p>--- hardware --</p>
<p>cpu structure</p>
<p>ISA &amp; mictoarchitecture separation</p>
<p>slow memory</p>
<p>code reordering</p>
<hr />
<p>example</p>
<p>Java thread withot join, with join
bytecote -&gt; JVM -&gt; clib, pthread -&gt; ELF </p>
<p>C example with phread
C++ woth thread -&gt; pthread, glibc or musl, nptl, ....</p>
<p>Go and friends</p>
<p>RUST</p>
<p>strace CLONE, FUTEX</p>
<p>?? pthread cancellation </p>
<p>assembly snippet</p>
<hr />
<p>--- THREAD anaylogy probably with baristas</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
